(()=>{"use strict";const t="gesture-rotation",e="gesture-scale",n="mouse-rotation",i="mouse-scale",s="onefingermove",a="twofingermove",o="rotatemousemove",l="scalemousemove";AFRAME.registerComponent("gesture-detector",{targetElement:null,internalState:{previousState:null,currentState:null},schema:{enabled:{type:"boolean",default:!0}},init:function(){this.targetElement||(this.targetElement=this.el),this.targetElement.addEventListener("touchstart",this.onTouch.bind(this)),this.targetElement.addEventListener("touchend",this.onTouch.bind(this)),this.targetElement.addEventListener("touchmove",this.onTouch.bind(this))},onTouch:function(t){if(!this.data.enabled)return;const e=t,n=this.getTouchState(e),i=this.internalState.previousState,s=i&&n&&n?.count==i?.count,a=!i&&n;i&&!s&&this.onTouchEnd(i),a&&this.onTouchStart(n),s&&this.onTouchMove(i,n)},onTouchStart:function(t){t.startTime=performance.now(),t.startPosition=t.position,t.startSpread=t.spread;const e=this.getEventPrefix(t.count)+"fingerstart";this.el.emit(e,t),this.internalState.previousState=t},onTouchEnd:function(t){const e=this.getEventPrefix(t.count)+"fingerend";this.el.emit(e,t),this.internalState.previousState=null},onTouchMove:function(t,e){const n={positionChange:{x:e.position.x-t.position.x,y:e.position.y-t.position.y},spreadChange:0};var i;i=e?.spread,null!=i&&(n.spreadChange=e.spread-(t.spread??0)),Object.assign(t,e),Object.assign(n,t);const s=this.getEventPrefix(e.count)+"fingermove";this.el.emit(s,n)},getTouchState:function(t){if(0===t.touches.length)return null;const e={x:0,y:0},n={count:t.touches.length,rawPosition:e,position:e},i=[];for(let e=0;e<t.touches.length;e++)i.push(t.touches[e]);const s=i.reduce(((t,e)=>t+e.clientX),0)/i.length,a=i.reduce(((t,e)=>t+e.clientY),0)/i.length;n.rawPosition={x:s,y:a};const o=2/(window.innerHeight+window.innerWidth);if(n.position={x:s*o,y:a*o},1==i.length)return n;const l=i.reduce(((t,e)=>{const n=Math.pow(s-e.clientX,2),i=Math.pow(a-e.clientY,2);return t+Math.sqrt(n+i)}),0)/i.length;return n.spread=l*o,n},getEventPrefix:function(t){return["one","two","three","many"][Math.min(t,4)-1]}});const r="image-markerFound",h="image-markerLost";AFRAME.registerComponent(t,{el:null,schema:{enabled:{type:"boolean",default:!0},rotationFactor:{type:"number",default:5}},init:function(){this.el.sceneEl&&(this.el.sceneEl.addEventListener(r,(()=>{this.el.sceneEl&&this.el.sceneEl.addEventListener(s,this.onRotation.bind(this))})),this.el.sceneEl.addEventListener(h,(()=>{this.el.sceneEl&&this.el.sceneEl.removeEventListener(s,this.onRotation)})))},onRotation:function(t){this.data.enabled&&t.detail.positionChange&&(this.el.object3D.rotation.y+=t.detail.positionChange.x*this.data.rotationFactor,this.el.object3D.rotation.x+=t.detail.positionChange.y*this.data.rotationFactor)}}),AFRAME.registerComponent(e,{scaleFactor:1,initialScale:{x:0,y:0,z:0},el:null,schema:{enabled:{type:"boolean",default:!0},minScale:{type:"number",default:.3},maxScale:{type:"number",default:8}},init:function(){this.el.sceneEl&&(this.initialScale=this.el.object3D.scale.clone(),this.el.sceneEl.addEventListener(r,(()=>{this.el.sceneEl&&this.el.sceneEl.addEventListener(a,this.onScaling.bind(this))})),this.el.sceneEl.addEventListener(h,(()=>{this.el.sceneEl&&this.el.sceneEl.removeEventListener(a,this.onScaling)})))},onScaling:function(t){if(!this.data.enabled)return;if(!t.detail.spreadChange||!t.detail.startSpread)return;const{spreadChange:e,startSpread:n}=t.detail;this.scaleFactor*=1+e/n,this.scaleFactor=Math.min(this.data.maxScale,Math.max(this.data.minScale,this.scaleFactor)),this.el.object3D.scale.set(this.initialScale.x*this.scaleFactor,this.initialScale.y*this.scaleFactor,this.initialScale.z*this.scaleFactor)}}),AFRAME.registerComponent("mouse-detector",{targetElement:null,internalState:{previousState:null,currentState:null,active:!1},schema:{enabled:{type:"boolean",default:!0}},init:function(){this.targetElement||(this.targetElement=this.el),this.targetElement.addEventListener("mousedown",(t=>{this.internalState.active=!0,this.onMouse(t)})),this.targetElement.addEventListener("mouseup",(t=>{this.internalState.active=!1,this.onMouse(t)})),this.targetElement.addEventListener("mousemove",this.onMouse.bind(this)),this.targetElement.addEventListener("wheel",this.onWheel.bind(this))},onMouse:function(t){if(!this.data.enabled)return;const e=t,n=this.getMouseState(e),i=this.internalState.previousState,s=i&&n,a=this.internalState.active,o=s&&a,l=!i&&n;i&&!o&&this.onMouseEnd(i),l&&this.onMouseStart(n),o&&this.onMouseMove(i,n)},onMouseStart:function(t){t.startPosition=t.position,this.el.emit("rotatemousestart",t),this.internalState.previousState=t},onMouseEnd:function(t){this.el.emit("rotatemouseend",t),this.internalState.previousState=null},onMouseMove:function(t,e){const n={positionChange:{x:e.position.x-t.position.x,y:e.position.y-t.position.y}};Object.assign(t,e),Object.assign(n,t),this.el.emit(o,n)},getMouseState:function(t){const e={x:0,y:0},n={rawPosition:e,position:e};n.rawPosition={x:t.clientX,y:t.clientY};const i=2/(window.innerHeight+window.innerWidth);return n.position={x:n.rawPosition.x*i,y:n.rawPosition.y*i},n},onWheel:function(t){const e=t,n=2/(window.innerHeight+window.innerWidth),i=Math.sign(e.deltaY)*n*10;this.el.emit(l,{spreadChange:i})}}),AFRAME.registerComponent(n,{el:null,schema:{enabled:{type:"boolean",default:!0},rotationFactor:{type:"number",default:5}},init:function(){this.el.sceneEl&&(this.el.sceneEl.addEventListener(r,(()=>{this.el.sceneEl&&this.el.sceneEl.addEventListener(o,this.onRotation.bind(this))})),this.el.sceneEl.addEventListener(h,(()=>{this.el.sceneEl&&this.el.sceneEl.removeEventListener(o,this.onRotation)})))},onRotation:function(t){this.data.enabled&&t.detail.positionChange&&(this.el.object3D.rotation.y+=t.detail.positionChange.x*this.data.rotationFactor,this.el.object3D.rotation.x+=t.detail.positionChange.y*this.data.rotationFactor)}}),AFRAME.registerComponent(i,{scaleFactor:1,initialScale:{x:0,y:0,z:0},el:null,schema:{enabled:{type:"boolean",default:!0},minScale:{type:"number",default:.3},maxScale:{type:"number",default:8}},init:function(){this.el.sceneEl&&(this.initialScale=this.el.object3D.scale.clone(),this.el.sceneEl.addEventListener(r,(()=>{this.el.sceneEl&&this.el.sceneEl.addEventListener(l,this.onScaling.bind(this))})),this.el.sceneEl.addEventListener(h,(()=>{this.el.sceneEl&&this.el.sceneEl.removeEventListener(l,this.onScaling)})))},onScaling:function(t){if(!this.data.enabled)return;if(!t.detail.spreadChange)return;const{spreadChange:e}=t.detail;this.scaleFactor*=1+e,this.scaleFactor=Math.min(this.data.maxScale,Math.max(this.data.minScale,this.scaleFactor)),this.el.object3D.scale.set(this.initialScale.x*this.scaleFactor,this.initialScale.y*this.scaleFactor,this.initialScale.z*this.scaleFactor)}})})();